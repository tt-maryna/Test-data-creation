{
	"info": {
		"_postman_id": "09929353-3c0d-4840-8154-8697e335faeb",
		"name": "Run collection with data file",
		"description": "# üìÅ Get started here\n\nThe _Postman Collection Runner_ enables you to run a collection's requests in a specified sequence. It also supports selecting a data file to let you use sets of values in a collection run.\n\nFor each row of data in the input file, Postman will:\n\n- Populate variables for each piece of data.\n    \n- Execute the requests in the collection with access to those variables.\n    \n\nThis powerful feature enables you to perform batch operations with dynamic data.\n\n## üîñ How to use this template\n\n#### Step 1: Prepare the data file\n\nSave the data you want to use in a CSV file. For example, you can save a list of usernames and email addresses.\n\n```\nusername,email\njamilahassan,jamila.hassan123@example.com\nabdoulkone,abdoul.kone456@example.com\njessicakimani,jessica.kimani789@example.com\nmariobalotelli,mario.balotelli234@example.com\nkristianolsson,kristian.olsson567@example.com\njuliapark,julia.park890@example.com\nmohammedali,mohammed.ali1234@example.com\ncarolynwang,carolyn.wang567@example.com\nbenedicteik,ben√©dicte.ik890@example.com\nrafaelcruz,rafael.cruz123@example.com\narjunsingh,arjun.singh456@example.com\nnatashapatel,natasha.patel789@example.com\nsamanthachen,samantha.chen234@example.com\nyoussefaziz,youssef.aziz567@example.com\namalasif,amal.asif890@example.com\nalishamalik,alisha.malik1234@example.com\njuanramirez,juan.ramirez567@example.com\nmarisalopez,marisa.lopez890@example.com\nhenrywang,henry.wang123@example.com\nandreasandersen,andreas.andersen456@example.com\n\n ```\n\n#### Step 2: Select the data file\n\nClick on \"Run\". Select the input data file you created in Step 1 by clicking \"Select File\". Update the other configuration if needed.\n\n<img src=\"https://content.pstmn.io/2720d8ee-6ddb-456e-a292-6ac02bf52dbc/U2NyZWVuc2hvdCAyMDIzLTA0LTEwIGF0IDYuMjcuMDcgUE0ucG5n\">\n\n#### Step 3: Preview the variable names and values\n\nBefore executing the requests, you can preview the variable names and values that will be set from the selected data file. You can consume these variables in requests just like any other variables. For example, you can use them in the URL:\n\n```\nhttps://postman-echo.com/get?username={{username}}\n\n ```\n\nOr in the request body:\n\n``` json\n{\n  username: \"{{username}}\"\n}\n\n ```\n\n#### Step 4: Execute requests using Collection Runner\n\nOnce you have reviewed the variables, you can execute the requests in the collection with the selected data file. Postman will populate variables for each piece of data and execute the requests using those variables.\n\n## ‚ÑπÔ∏è Resources\n\n[Using the Collection Runner](https://learning.postman.com/docs/collections/running-collections/intro-to-collection-runs/)\n\n[Importing data files](https://learning.postman.com/docs/collections/running-collections/working-with-data-files/)",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "32782134"
	},
	"variable": [],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Check if we already have a valid token",
					"if (!pm.environment.get('access_token')) {",
					"    console.log('Getting access token...');",
					"    ",
					"    pm.sendRequest({",
					"        url: pm.environment.get('url') + '/' + pm.environment.get('account') + '/auth/oauth2/token',",
					"        method: 'POST',",
					"        header: {",
					"            'Content-Type': 'application/x-www-form-urlencoded'",
					"        },",
					"        body: {",
					"            mode: 'urlencoded',",
					"            urlencoded: [",
					"                {key: 'grant_type', value: 'password'},",
					"                {key: 'username', value: pm.environment.get('username')},",
					"                {key: 'password', value: pm.environment.get('password')},",
					"                {key: 'client_id', value: pm.environment.get('client_id')},",
					"                {key: 'client_secret', value: pm.environment.get('client_secret')}",
					"            ]",
					"        }",
					"    }, function (err, response) {",
					"        if (err) {",
					"            console.log('Error getting token:', err);",
					"        } else if (response.code === 200) {",
					"            var jsonData = response.json();",
					"            pm.environment.set('access_token', jsonData.access_token);",
					"            console.log('Token obtained successfully');",
					"        } else {",
					"            console.log('Failed to get token. Status:', response.code);",
					"        }",
					"    });",
					"}"
				]
			}
		}
	],
	"item": [
		{
			"name": "timetrackings",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"type": "text/javascript",
						"exec": [
							"// Handle start_time_timezone assignment",
							"if (!pm.iterationData.has('start_time_timezone')) {",
							"    // Field not sent at all - use default Europe/Vienna",
							"    pm.variables.set('start_time_timezone', 'Europe/Vienna');",
							"    console.log('Start timezone not provided in data, using default: Europe/Vienna');",
							"} else {",
							"    // Field is present in data - use it",
							"    var startTimezone = pm.iterationData.get('start_time_timezone');",
							"    pm.variables.set('start_time_timezone', startTimezone);",
							"    console.log('Using start_time_timezone from data file:', startTimezone);",
							"}",
							"",
							"// Handle end_time_timezone assignment",
							"if (!pm.iterationData.has('end_time_timezone')) {",
							"    // Field not sent at all - use default Europe/Vienna",
							"    pm.variables.set('end_time_timezone', 'Europe/Vienna');",
							"    console.log('End timezone not provided in data, using default: Europe/Vienna');",
							"} else {",
							"    // Field is present in data - use it",
							"    var endTimezone = pm.iterationData.get('end_time_timezone');",
							"    pm.variables.set('end_time_timezone', endTimezone);",
							"    console.log('Using end_time_timezone from data file:', endTimezone);",
							"}"
						]
					}
				}
			],
			"item": [
				{
					"name": "create",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    // Log the full response body",
									"    console.log(\"Response body:\", pm.response.text());",
									"});"
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "user_id",
									"value": "{{user_id}}",
									"type": "text"
								},
								{
									"key": "task_id",
									"value": "{{task_id}}",
									"type": "text"
								},
								{
									"key": "start_time",
									"value": "{{start_time}}",
									"type": "text"
								},
								{
									"key": "end_time",
									"value": "{{end_time}}",
									"type": "text"
								},
								{
									"key": "start_time_timezone",
									"value": "{{start_time_timezone}}",
									"type": "text"
								},
								{
									"key": "end_time_timezone",
									"value": "{{end_time_timezone}}",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{url}}/{{account}}/{{version}}/timeTrackings/create/",
							"host": [
								"{{url}}"
							],
							"path": [
								"{{account}}",
								"{{version}}",
								"timeTrackings",
								"create",
								""
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "departments",
			"item": [
				{
					"name": "create",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "department_name",
									"value": "{{department_name}}",
									"type": "text"
								},
								{
									"key": "mother_id",
									"value": "{{mother_id}}",
									"type": "text"
								},
								{
									"key": "supervisor_id",
									"value": "{{supervisor_id}}",
									"type": "text",
									"disabled": true
								},
								{
									"key": "supervisor_assistant_id",
									"value": "{{supervisor_assistant_id}}",
									"type": "text",
									"disabled": true
								}
							]
						},
						"url": {
							"raw": "{{url}}/{{account}}/{{version}}/departments/create/",
							"host": [
								"{{url}}"
							],
							"path": [
								"{{account}}",
								"{{version}}",
								"departments",
								"create",
								""
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "tasks",
			"item": [
				{
					"name": "create",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"type": "text/javascript",
								"exec": [
									"// ==================================================================================",
									"// SMART ASSIGNMENT LOGIC FOR TASK-PROJECT RELATIONSHIPS",
									"// ==================================================================================",
									"// This prerequest script implements intelligent mother_id assignment for tasks:",
									"//",
									"// 1. DYNAMIC ASSIGNMENT: When mother_id is not specified in task data,",
									"//    automatically use project IDs extracted from previously created projects",
									"//    in the same script execution (passed via global variable 'extracted_project_ids')",
									"//",
									"// 2. FALLBACK DEFAULT: When no extracted project IDs are available,", 
									"//    use mother_id = 3 (General Tasks project) as a safe default",
									"//",
									"// 3. EXPLICIT OVERRIDE: When mother_id is provided in task data,",
									"//    use the exact value specified, bypassing all smart assignment",
									"//",
									"// This enables workflows like: './create_test_data.sh projects tasks'", 
									"// where tasks automatically inherit from newly created projects.",
									"// ==================================================================================",
									"",
									"// Handle mother_id assignment with smart logic",
									"if (!pm.iterationData.has('mother_id')) {",
									"    // Field not sent at all - try to use extracted project IDs",
									"    console.log('Mother ID not provided in data, checking for extracted project IDs...');",
									"    ",
									"    // Check if we have extracted project IDs from output.txt",
									"    var extractedProjectIds = pm.globals.get('extracted_project_ids');",
									"    ",
									"    if (extractedProjectIds) {",
									"        try {",
									"            var projectIdsArray = JSON.parse(extractedProjectIds);",
									"            if (projectIdsArray && projectIdsArray.length > 0) {",
									"                // Select a random project ID from extracted ones",
									"                var randomIndex = Math.floor(Math.random() * projectIdsArray.length);",
									"                var selectedProjectId = projectIdsArray[randomIndex];",
									"                pm.variables.set('mother_id', selectedProjectId);",
									"                console.log('Selected random mother_id from extracted IDs:', selectedProjectId);",
									"            } else {",
									"                // Fallback to default",
									"                pm.variables.set('mother_id', '3');",
									"                console.log('No extracted project IDs available, using default mother_id: 3');",
									"            }",
									"        } catch (e) {",
									"            // Fallback to default if JSON parsing fails",
									"            pm.variables.set('mother_id', '3');",
									"            console.log('Error parsing extracted project IDs, using default mother_id: 3');",
									"        }",
									"    } else {",
									"        // Fallback to default if no extracted data available",
									"        pm.variables.set('mother_id', '3');",
									"        console.log('No extracted project IDs available, using default mother_id: 3');",
									"    }",
									"} else {",
									"    // Field is present in data",
									"    var motherId = pm.iterationData.get('mother_id');",
									"    ",
									"    if (motherId === '' || motherId === null) {",
									"        // Field sent but empty - try to use extracted project IDs",
									"        var extractedProjectIds = pm.globals.get('extracted_project_ids');",
									"        if (extractedProjectIds) {",
									"            try {",
									"                var projectIdsArray = JSON.parse(extractedProjectIds);",
									"                if (projectIdsArray && projectIdsArray.length > 0) {",
									"                    var randomIndex = Math.floor(Math.random() * projectIdsArray.length);",
									"                    var selectedProjectId = projectIdsArray[randomIndex];",
									"                    pm.variables.set('mother_id', selectedProjectId);",
									"                    console.log('Mother ID is empty in data file, using extracted project_id:', selectedProjectId);",
									"                } else {",
									"                    pm.variables.set('mother_id', '3');",
									"                    console.log('No extracted project IDs available, using default mother_id: 3');",
									"                }",
									"            } catch (e) {",
									"                pm.variables.set('mother_id', '3');",
									"                console.log('Error parsing extracted project IDs, using default mother_id: 3');",
									"            }",
									"        } else {",
									"            pm.variables.set('mother_id', '3');",
									"            console.log('No extracted project IDs available, using default mother_id: 3');",
									"        }",
									"    } else {",
									"        // Field sent with value - use it exactly",
									"        pm.variables.set('mother_id', motherId);",
									"        console.log('Using mother_id from data file:', motherId);",
									"    }",
									"}"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "mother_id",
									"value": "{{mother_id}}",
									"type": "text"
								},
								{
									"key": "name",
									"value": "{{name}}",
									"type": "text"
								},
								{
									"key": "is_billable",
									"value": "{{is_billable}}",
									"type": "text"
								},
								{
									"key": "is_paid_non_working",
									"value": "{{is_paid_non_working}}",
									"type": "text"
								},
								{
									"key": "is_nonworking",
									"value": "{{is_nonworking}}",
									"type": "text"
								},
								{
									"key": "task_type",
									"value": "{{task_type}}",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{url}}/{{account}}/{{version}}/tasks/create/",
							"host": [
								"{{url}}"
							],
							"path": [
								"{{account}}",
								"{{version}}",
								"tasks",
								"create",
								""
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "users",
			"item": [
				{
					"name": "read-departments",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Store department IDs for use in user creation",
									"if (pm.response.code === 200) {",
									"    var jsonData = pm.response.json();",
									"    if (jsonData.Success && jsonData.Results) {",
									"        var departmentIds = jsonData.Results.map(dept => dept.id);",
									"        pm.environment.set('available_department_ids', JSON.stringify(departmentIds));",
									"        console.log('Available department IDs:', departmentIds);",
									"    } else {",
									"        console.log('Failed to get departments, will use default department_id=1');",
									"        pm.environment.set('available_department_ids', '[1]');",
									"    }",
									"} else {",
									"    console.log('Departments request failed, will use default department_id=1');",
									"    pm.environment.set('available_department_ids', '[1]');",
									"}"
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{url}}/{{account}}/{{version}}/departments/read/?active=true",
							"host": [
								"{{url}}"
							],
							"path": [
								"{{account}}",
								"{{version}}",
								"departments",
								"read",
								""
							],
							"query": [
								{
									"key": "active",
									"value": "true"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "read-workschedules",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Store workschedule IDs for use in user creation",
									"if (pm.response.code === 200) {",
									"    var jsonData = pm.response.json();",
									"    if (jsonData.Success && jsonData.Results) {",
									"        var workscheduleIds = jsonData.Results.map(ws => ws.id);",
									"        pm.environment.set('available_workschedule_ids', JSON.stringify(workscheduleIds));",
									"        console.log('Available workschedule IDs:', workscheduleIds);",
									"    } else {",
									"        console.log('Failed to get workschedules, will use default timesheet_template_id=4');",
									"        pm.environment.set('available_workschedule_ids', '[4]');",
									"    }",
									"} else {",
									"    console.log('Workschedules request failed, will use default timesheet_template_id=4');",
									"    pm.environment.set('available_workschedule_ids', '[4]');",
									"}"
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{url}}/{{account}}/{{version}}/workSchedules/read/?active=true",
							"host": [
								"{{url}}"
							],
							"path": [
								"{{account}}",
								"{{version}}",
								"workSchedules",
								"read",
								""
							],
							"query": [
								{
									"key": "active",
									"value": "true"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "create",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Handle department_id assignment",
									"if (!pm.iterationData.has('department_id')) {",
									"    // Field not sent at all - assign random value",
									"    console.log('Department ID not provided in data, selecting random...');",
									"    ",
									"    // Get available department IDs from environment (set by read-departments request)",
									"    var availableDeptIds = pm.environment.get('available_department_ids');",
									"    ",
									"    if (availableDeptIds) {",
									"        try {",
									"            var deptIdsArray = JSON.parse(availableDeptIds);",
									"            if (deptIdsArray && deptIdsArray.length > 0) {",
									"                // Select a random department ID",
									"                var randomIndex = Math.floor(Math.random() * deptIdsArray.length);",
									"                var selectedDeptId = deptIdsArray[randomIndex];",
									"                pm.variables.set('department_id', selectedDeptId);",
									"                console.log('Selected random department_id:', selectedDeptId);",
									"            } else {",
									"                // Fallback to default",
									"                pm.variables.set('department_id', '1');",
									"                console.log('No departments available, using default department_id: 1');",
									"            }",
									"        } catch (e) {",
									"            // Fallback to default if JSON parsing fails",
									"            pm.variables.set('department_id', '1');",
									"            console.log('Error parsing department IDs, using default department_id: 1');",
									"        }",
									"    } else {",
									"        // Fallback to default if no departments data available",
									"        pm.variables.set('department_id', '1');",
									"        console.log('No departments data available, using default department_id: 1');",
									"    }",
									"} else {",
									"    // Field is present in data",
									"    var departmentId = pm.iterationData.get('department_id');",
									"    ",
									"    if (departmentId === '' || departmentId === null) {",
									"        // Field sent but empty - use default value 1",
									"        pm.variables.set('department_id', '1');",
									"        console.log('Department ID is empty in data file, using default: 1');",
									"    } else {",
									"        // Field sent with value - use it",
									"        pm.variables.set('department_id', departmentId);",
									"        console.log('Using department_id from data file:', departmentId);",
									"    }",
									"}",
									"",
									"// Handle timesheet_template_id assignment",
									"if (!pm.iterationData.has('timesheet_template_id')) {",
									"    // Field not sent at all - assign random value",
									"    console.log('Timesheet template ID not provided in data, selecting random...');",
									"    ",
									"    // Get available workschedule IDs from environment (set by read-workschedules request)",
									"    var availableWsIds = pm.environment.get('available_workschedule_ids');",
									"    ",
									"    if (availableWsIds) {",
									"        try {",
									"            var wsIdsArray = JSON.parse(availableWsIds);",
									"            if (wsIdsArray && wsIdsArray.length > 0) {",
									"                // Select a random workschedule ID",
									"                var randomIndex = Math.floor(Math.random() * wsIdsArray.length);",
									"                var selectedWsId = wsIdsArray[randomIndex];",
									"                pm.variables.set('timesheet_template_id', selectedWsId);",
									"                console.log('Selected random timesheet_template_id:', selectedWsId);",
									"            } else {",
									"                // Fallback to default",
									"                pm.variables.set('timesheet_template_id', '1');",
									"                console.log('No workschedules available, using default timesheet_template_id: 1');",
									"            }",
									"        } catch (e) {",
									"            // Fallback to default if JSON parsing fails",
									"            pm.variables.set('timesheet_template_id', '1');",
									"            console.log('Error parsing workschedule IDs, using default timesheet_template_id: 1');",
									"        }",
									"    } else {",
									"        // Fallback to default if no workschedules data available",
									"        pm.variables.set('timesheet_template_id', '1');",
									"        console.log('No workschedules data available, using default timesheet_template_id: 1');",
									"    }",
									"} else {",
									"    // Field is present in data",
									"    var timesheetTemplateId = pm.iterationData.get('timesheet_template_id');",
									"    ",
									"    if (timesheetTemplateId === '' || timesheetTemplateId === null) {",
									"        // Field sent but empty - use default value 1",
									"        pm.variables.set('timesheet_template_id', '1');",
									"        console.log('Timesheet template ID is empty in data file, using default: 1');",
									"    } else {",
									"        // Field sent with value - use it",
									"        pm.variables.set('timesheet_template_id', timesheetTemplateId);",
									"        console.log('Using timesheet_template_id from data file:', timesheetTemplateId);",
									"    }",
									"}"
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "email_address",
									"value": "{{email_address}}",
									"type": "text"
								},
								{
									"key": "username",
									"value": "{{username}}",
									"type": "text"
								},
								{
									"key": "department_id",
									"value": "{{department_id}}",
									"type": "text"
								},
								{
									"key": "lastname",
									"value": "{{lastname}}",
									"type": "text"
								},
								{
									"key": "firstname",
									"value": "{{firstname}}",
									"type": "text"
								},
								{
									"key": "password",
									"value": "12345aC!",
									"type": "text"
								},
								{
									"key": "language_id",
									"value": "{{language_id}}",
									"type": "text"
								},
								{
									"key": "internal_user_group",
									"value": "2",
									"type": "text"
								},
								{
									"key": "timesheet_template_id",
									"value": "{{timesheet_template_id}}",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{url}}/{{account}}/{{version}}/users/create/",
							"host": [
								"{{url}}"
							],
							"path": [
								"{{account}}",
								"{{version}}",
								"users",
								"create",
								""
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "projects",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"type": "text/javascript",
						"exec": [
							"// Handle status assignment",
							"if (!pm.iterationData.has('status')) {",
							"    // Field not sent at all - use default status 2 (ACTIVE)",
							"    pm.variables.set('status', '2');",
							"    console.log('Status not provided in data, using default: 2 (ACTIVE)');",
							"} else {",
							"    // Field is present in data - use it",
							"    var status = pm.iterationData.get('status');",
							"    if (status === '' || status === null) {",
							"        // Field sent but empty - use default status 2",
							"        pm.variables.set('status', '2');",
							"        console.log('Status is empty in data file, using default: 2 (ACTIVE)');",
							"    } else {",
							"        // Field sent with value - use it",
							"        pm.variables.set('status', status);",
							"        console.log('Using status from data file:', status);",
							"    }",
							"}"
						]
					}
				}
			],
			"item": [
				{
					"name": "create",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded"
							},
							{
								"key": "Cookie",
								"value": "SECRETTOKEN=379319eb0358576f73dbadc80f78db6589e39995fa6c4f566c86bd09a078d06b"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "name",
									"value": "{{name}}",
									"type": "text"
								},
								{
									"key": "mother_id",
									"value": "1",
									"type": "text"
								},
								{
									"key": "status",
									"value": "{{status}}",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{url}}/{{account}}/{{version}}/projects/create/",
							"host": [
								"{{url}}"
							],
							"path": [
								"{{account}}",
								"{{version}}",
								"projects",
								"create",
								""
							]
						}
					},
					"response": []
				}
			]
		}
	]
}